(function(e,c,g){var d="uploadCollection",a=c.document,f={sortable:false,sortable_field:"position",trans:{maxNumFiles:"Maximum number of files exceeded",typeNotAllowed:"File type not allowed",maxFileSize:"File is too big",minFileSize:"File is too small",confirmBatchDelete:"Are you sure you want to delete all selected elements?"},javascript:function(h){}};function b(i,h){this.element=i;this.options=e.extend({},f,h);this._defaults=f;this._name=d;this._extendBlueImpWidget();this._init()}b.prototype={_init:function(){var h=this;this.$element=e(this.element);this.$widgetContainer=e("#"+this.element.id+"_widget_container");this.$filesContainer=e("#"+this.element.id+"_files_list");this.$widgetContainer.fileupload({fileInput:this.$element,replaceFileInput:false,uploadTemplateId:this.element.id+"_upload_template",downloadTemplateId:this.element.id+"_download_template",filesContainer:this.$filesContainer,dropZone:this.$widgetContainer,pasteZone:this.$widgetContainer,destroy:function(k,j){var i=e(this).data("fileupload");i._adjustMaxNumberOfFiles(1);i._transition(j.context).done(function(){e(this).remove();i._trigger("destroyed",k,j)})},maxNumberOfFiles:this.options.maxNumberOfFiles,maxFileSize:this.options.maxFileSize,minFileSize:this.options.minFileSize,acceptFileTypes:this.options.acceptFileTypes,previewAsCanvas:this.options.previewAsCanvas,prependFiles:this.options.prependFiles,previewSourceFileTypes:this.options.previewSourceFileTypes,previewSourceMaxFileSize:this.options.previewSourceMaxFileSize,previewMaxWidth:this.options.previewMaxWidth,previewMaxHeight:this.options.previewMaxHeight});if(this.options.sortable){e("#"+this.element.id+"_files_list").sortable({helper:function(j,i){i.children().each(function(){e(this).css("width",e(this).width())});return i},cancel:"a, button, img, input, textarea, select",items:"> tr.template-download",update:function(j,i){i.item.children().each(function(){e(this).css("width","")});e('[id^="'+this.element.id+'"][id$="'+this.options.sortable_field+'"]').each(function(k){e(this).val(k)})}})}},loadFiles:function(h){this.$widgetContainer.fileupload("option","done").call(this.$widgetContainer,null,{result:h})},_extendBlueImpWidget:function(){var h=this;e.widget("blueimp.fileupload",e.blueimp.fileupload,{options:{},_hasError:function(i){if(i.error){return i.error}if(this.options.maxNumberOfFiles<0){return h.options.trans.maxNumFiles}if(!(this.options.acceptFileTypes.test(i.type)||this.options.acceptFileTypes.test(i.name))){return h.options.trans.typeNotAllowed}if(this.options.maxFileSize&&i.size>this.options.maxFileSize){return h.options.trans.maxFileSize}if(typeof i.size==="number"&&i.size<this.options.minFileSize){return h.options.trans.minFileSize}return null},_initButtonBarEventHandlers:function(){var i=this.element.find(".fileupload-buttonbar"),j=this.options.filesContainer;this._on(i.find(".start"),{click:function(k){k.preventDefault();j.find(".start button").click()}});this._on(i.find(".cancel"),{click:function(k){k.preventDefault();j.find(".cancel button").click()}});this._on(i.find(".delete"),{click:function(k){k.preventDefault();if(confirm(h.options.trans.confirmBatchDelete)){j.find(".delete input:checked").parent().siblings("button").click();i.find(".toggle").prop("checked",false)}}});this._on(i.find(".toggle"),{change:function(k){j.find(".delete input").prop("checked",e(k.currentTarget).is(":checked"))}})}})}};e.fn[d]=function(i){var h=arguments;if(i===g||typeof i==="object"){return this.each(function(){if(!e.data(this,"plugin_"+d)){e.data(this,"plugin_"+d,new b(this,i))}})}else{if(typeof i==="string"&&i[0]!=="_"&&i!=="init"){var j;this.each(function(){var k=e.data(this,"plugin_"+d);if(k instanceof b&&typeof k[i]==="function"){j=k[i].apply(k,Array.prototype.slice.call(h,1))}if(i==="destroy"){e.data(this,"plugin_"+d,null)}});return j!==g?j:this}}}}(jQuery,window));